<p>Using Objective-C++ for Components offers some serious wins in syntax. Yes, this means you need to touch a limited subset of C++ to work on feed as a product engineer.</p>

<p>{pxlcld/kRk3}</p>

<p>Here again is a sample feed story component:</p>

<p><code>objc++
[CKStackLayoutComponent 
 newWithStyle:{
  .direction = CKStackLayoutComponentDirectionVertical,
 } 
 children:{
   {[CKFeedStoryHeaderComponent newWithStory:story]},
   {[CKFeedStoryMessageComponent newWithStory:story]},
   {[CKUFIComponent newWithFeedback:story.feedback]},
 }];
</code></p>

<p>Here’s what it might look like in pure Objective-C:</p>

<div class="redhighlight"><pre><code class="language-objc--" data-lang="objc++"><span class="p">[</span><span class="n">CKStackLayoutComponent</span> <span class="nl">newWithStyle</span><span class="p">:[[</span><span class="n">CKStackLayoutComponentStyle</span> <span class="n">alloc</span><span class="p">]</span> <span class="nl">initWithDirection</span><span class="p">:</span><span class="n">CKStackLayoutComponentDirectionVertical</span>
                                                                             <span class="nl">justifyContent</span><span class="p">:</span><span class="n">CKStackLayoutComponentJustifyContentStart</span>
                                                                                 <span class="nl">alignItems</span><span class="p">:</span><span class="n">CKStackLayoutComponentAlignItemsStart</span>
                                                                                    <span class="nl">spacing</span><span class="p">:</span><span class="mi">0</span><span class="p">]</span>
                            <span class="nl">children</span><span class="p">:</span><span class="l">@[</span>
  <span class="p">[</span><span class="n">CKStackLayoutComponentChild</span> <span class="nl">childWithComponent</span><span class="p">:[</span><span class="n">CKFeedStoryHeaderComponent</span> <span class="nl">newWithStory</span><span class="p">:</span><span class="n">story</span><span class="p">]</span>
                                       <span class="nl">topPadding</span><span class="p">:</span><span class="mi">0</span>
                                      <span class="nl">leftPadding</span><span class="p">:</span><span class="mi">0</span>
                                    <span class="nl">bottomPadding</span><span class="p">:</span><span class="mi">0</span><span class="p">],</span>
  <span class="p">[</span><span class="n">CKStackLayoutComponentChild</span> <span class="nl">childWithComponent</span><span class="p">:[</span><span class="n">CKFeedStoryMessageComponent</span> <span class="nl">newWithStory</span><span class="p">:</span><span class="n">story</span><span class="p">]</span>
                                       <span class="nl">topPadding</span><span class="p">:</span><span class="mi">0</span>
                                      <span class="nl">leftPadding</span><span class="p">:</span><span class="mi">0</span>
                                    <span class="nl">bottomPadding</span><span class="p">:</span><span class="mi">0</span><span class="p">],</span>
  <span class="p">[</span><span class="n">CKStackLayoutComponentChild</span> <span class="nl">childWithComponent</span><span class="p">:[</span><span class="n">CKUFIComponent</span> <span class="nl">newWithFeedback</span><span class="p">:</span><span class="n">story</span><span class="p">.</span><span class="n">feedback</span><span class="p">]</span>
                                       <span class="nl">topPadding</span><span class="p">:</span><span class="mi">0</span>
                                      <span class="nl">leftPadding</span><span class="p">:</span><span class="mi">0</span>
                                    <span class="nl">bottomPadding</span><span class="p">:</span><span class="mi">0</span><span class="p">]</span>
<span class="l">]</span><span class="p">];</span></code></pre></div>

<h2 id="aggregate-initialization">Aggregate Initialization</h2>

<p>C and C++ have <a href="http://en.cppreference.com/w/cpp/language/aggregate_initialization">aggregate initialization</a>, which allows initializing a struct with very terse syntax. We need Objective-C++ to take advantage of this syntax because, unlike Objective-C, Objective-C++ allows putting Objective-C objects in structs when ARC is enabled.</p>

<p>You can be as expressive as you like; you can use <code>{ .name = value, ... }</code> or just <code>{ value1, value2, ... }</code>. (The latter form is shorter, but fragile to argument reordering and sometimes harder to read.) Note that you can easily omit fields; in the C++ example above, the padding-related values are omitted and default to 0.</p>

<h2 id="type-safety">Type Safety</h2>

<p>In the previous example the C++ would fail to compile if we inserted a child of the wrong type, while the Objective-C example compiles with any type in the array—even an <code>NSString *</code>.</p>

<h2 id="efficiency">Efficiency</h2>

<table>
  <tbody>
    <tr>
      <td>Being fully declarative and immutable means you use a <em>lot</em> of objects. C++ objects are far more efficient to create because they can be stack-allocated, [emplaced](http:*stackoverflow.com/questions/4303513/push-back-vs-emplace-back</td>
      <td>emplaced), <a href="http:*www.cprogramming.com/c++11/rvalue-references-and-move-semantics-in-c++11.html">moved</a>, etc.</td>
    </tr>
  </tbody>
</table>

<h2 id="nil-safety">Nil Safety</h2>

<p>Objective-C containers throw if you insert <code>nil</code> elements in them but C++ containers do not. Relaxing this constraint makes it convenient to write hierarchies where any individual child may be nil:</p>

<p><code>objc++
  children:{
    headerComponent,
    messageComponent,
    attachmentComponent,
    footerComponent
  }
</code></p>

<p>The alternative would be a bunch of conditionals in Objective-C:</p>

<div class="redhighlight"><pre><code class="language-objc--" data-lang="objc++"><span class="bp">NSMutableArray</span> <span class="o">*</span><span class="n">children</span> <span class="o">=</span> <span class="p">[</span><span class="bp">NSMutableArray</span> <span class="n">array</span><span class="p">];</span>
<span class="k">if</span> <span class="p">(</span><span class="n">headerComponent</span><span class="p">)</span> <span class="p">{</span>
  <span class="p">[</span><span class="n">children</span> <span class="nl">addObject</span><span class="p">:</span><span class="n">headerComponent</span><span class="p">];</span>
<span class="p">}</span>
<span class="k">if</span> <span class="p">(</span><span class="n">messageComponent</span><span class="p">)</span> <span class="p">{</span>
  <span class="p">[</span><span class="n">children</span> <span class="nl">addObject</span><span class="p">:</span><span class="n">messageComponent</span><span class="p">];</span>
<span class="p">}</span>
<span class="k">if</span> <span class="p">(</span><span class="n">attachmentComponent</span><span class="p">)</span> <span class="p">{</span>
  <span class="p">[</span><span class="n">children</span> <span class="nl">addObject</span><span class="p">:</span><span class="n">attachmentComponent</span><span class="p">];</span>
<span class="p">}</span>
<span class="k">if</span> <span class="p">(</span><span class="n">footerComponent</span><span class="p">)</span> <span class="p">{</span>
  <span class="p">[</span><span class="n">children</span> <span class="nl">addObject</span><span class="p">:</span><span class="n">footerComponent</span><span class="p">];</span>
<span class="p">}</span></code></pre></div>

