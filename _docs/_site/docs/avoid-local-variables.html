<p>In your <code>+new</code> method, avoid creating temporary local variables when possible.</p>

<ul>
  <li><strong>It makes code harder to read and modify</strong> since dependencies between local variables are hard to visualize.</li>
  <li><strong>It encourages mutating local variables after assignment</strong> which hides surprising side-effects and changes.</li>
</ul>

<p>Here is a really tangled-up <code>+new</code> method that is hard to read, understand, or modify:</p>

<div class="redhighlight"><pre><code class="language-objc--" data-lang="objc++"><span class="p">+</span> <span class="p">(</span><span class="kt">instancetype</span><span class="p">)</span><span class="nf">newWithStory:</span><span class="p">(</span><span class="n">CKMemFeedStory</span> <span class="o">*</span><span class="p">)</span><span class="nv">story</span> <span class="nf">options:</span><span class="p">(</span><span class="n">CKFeedStoryOptions</span><span class="p">)</span><span class="nv">options</span>
<span class="p">{</span>
  <span class="bp">NSAttributedString</span> <span class="o">*</span><span class="n">timestamp</span> <span class="o">=</span> <span class="p">[</span><span class="n">CKDateFormatter</span> <span class="nl">stringFromDate</span><span class="p">:</span><span class="n">story</span><span class="p">.</span><span class="n">creationTime</span><span class="p">];</span>
  <span class="n">CKFeedHeaderComponent</span> <span class="o">*</span><span class="n">header</span> <span class="o">=</span>
  <span class="p">[</span><span class="n">CKFeedHeaderComponent</span>
   <span class="nl">newWithTitle</span><span class="p">:</span><span class="n">story</span><span class="p">.</span><span class="n">title</span>
   <span class="nl">subtitle</span><span class="p">:</span><span class="n">timestamp</span><span class="p">];</span>

  <span class="c1">// LOGIC ERROR! timestamp has already been used by header, but no one warns us.</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">options</span> <span class="o">&amp;</span> <span class="n">CKFeedStoryOptionHideTimestamp</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">timestamp</span> <span class="o">=</span> <span class="nb">nil</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="n">CKFeedMessageOptions</span> <span class="n">messageOptions</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">options</span> <span class="o">&amp;</span> <span class="n">CKFeedStoryOptionShortMessage</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">messageOptions</span> <span class="o">|=</span> <span class="n">CKFeedMessageOptionShort</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="n">CKFeedMessageComponent</span> <span class="o">*</span><span class="n">message</span> <span class="o">=</span>
  <span class="p">[</span><span class="n">CKFeedMessageComponent</span>
   <span class="nl">newWithStory</span><span class="p">:</span><span class="n">story</span>
   <span class="nl">options</span><span class="p">:</span><span class="n">messageOptions</span><span class="p">];</span>

  <span class="n">CKFeedUFIComponent</span> <span class="o">*</span><span class="n">ufi</span> <span class="o">=</span> <span class="p">[</span><span class="n">CKFeedUFIComponent</span> <span class="nl">newWithStory</span><span class="p">:</span><span class="n">story</span><span class="p">];</span>

  <span class="c1">// SUBOPTIMAL: why did we create the header only to throw it away?</span>
  <span class="c1">// Also, notice how far this is from where we created the header.</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">options</span> <span class="o">&amp;</span> <span class="n">CKFeedStoryOptionOmitHeader</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">header</span> <span class="o">=</span> <span class="nb">nil</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="p">[</span><span class="nb">self</span> <span class="nl">newWithComponent</span><span class="p">:</span>
          <span class="p">[</span><span class="n">CKStackLayoutComponent</span>
           <span class="nl">newWithChildren</span><span class="p">:{</span>
             <span class="n">header</span><span class="p">,</span>
             <span class="n">message</span><span class="p">,</span>
             <span class="n">ufi</span>
           <span class="p">}]];</span>
<span class="p">}</span></code></pre></div>

<p>Instead, split out logic into separate components:</p>

<p>```objc++
+ (instancetype)newWithStory:(CKMemFeedStory *)story options:(CKFeedStoryOptions)options
{
  // Note how there are NO local variables here at all.
  return [self newWithComponent:
          [CKStackLayoutComponent
           newWithChildren:{
             [CKFeedStoryHeaderComponent
              newWithStory:story
              options:headerOptions(options)],
             [CKFeedStoryMessageComponent
              newWithStory:story
              options:messageOptions(options)],
             [CKFeedUFIComponent newWithStory:story]
           }]];
}</p>

<p>// Note how this is a pure function mapping from one options bitmask to another.
static CKFeedStoryHeaderComponentOptions headerOptions(CKFeedStoryOptions options)
{
  CKFeedStoryHeaderComponentOptions o;
  if (options &amp; CKFeedStoryOptionOmitHeader) {
    o |= CKFeedStoryHeaderComponentOptionOmit;
  }
  if (options &amp; CKFeedStoryOptionHideTimestamp) {
    o |= CKFeedStoryHeaderComponentOptionHideTimestamp;
  }
  return o;
}
```</p>
